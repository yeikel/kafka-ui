version: 2
updates:

- package-ecosystem: gradle
  directory: "/"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  labels:
    - "type/dependencies"
    - "scope/backend"
  ignore:
    # Disable dependabot pull requests for Netty
    # In general, our Netty references are temporary overrides, usually applied to address transitive Spring vulnerabilities, and should be configured with caution
    # In general, having conflicting Netty versions in the classpath is not recommended
    - dependency-name: "io.netty:*"
  groups:
    spring-boot-dependencies:
      patterns:
        - "org.springframework.boot:*"
        - "io.spring.dependency-management"
      # We will handle major upgrades manually
      update-types:
        - "patch"
        - "minor"
    # Update test dependencies separately
    test-dependencies:
      # TODO: Consider using dependency-type if https://github.com/dependabot/dependabot-core/issues/13122 is fixed
      patterns:
        - "org.testcontainers:*"
        - "org.mockito:*"
        - "org.junit.jupiter:*"
        - "org.assertj:*"
        - "org.sonarqube:*"
      update-types:
        - "minor"
        - "patch"
    # Update Apache Commons libraries together
    # These dependencies rarely introduce breaking changes
    # And it is safe to update them together without restrictions at the minor/patch level
    apache-commons-dependencies:
      patterns:
        - "org.apache.commons:*"
    kafka-dependencies:
      patterns:
        - "org.apache.kafka:*"
        - "io.confluent:*"
      # Kafka major upgrades generally require more work due to breaking changes
      update-types:
        - "patch"
        - "minor"
    json-schema-dependencies:
      patterns:
        - "com.github.victools:jsonschema-generator"
        - "com.github.java-json-tools:json-schema-validator"
        - "org.openapitools.openapistylevalidator:*"
        - "org.openapi.generator:*"
        - "io.swagger.core.v3:*"
        - "jakarta.annotation:jakarta.annotation-api"
- package-ecosystem: docker
  directory: "/api"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  open-pull-requests-limit: 10
  ignore:
    # We handle Major Java updates manually
  - dependency-name: "azul/zulu-openjdk-alpine"
    update-types: ["version-update:semver-major"]
  labels:
    - "type/dependencies"
    - "scope/backend"

- package-ecosystem: npm
  directory: "/frontend"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  open-pull-requests-limit: 10
  versioning-strategy: increase-if-necessary
  labels:
    - "type/dependencies"
    - "scope/frontend"
  groups:
    pnpm-dependencies:
      patterns:
        - "*"
      update-types:
        - "patch"
        - "minor"

- package-ecosystem: "github-actions"
  directory: "/"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  groups:
    github-actions:
      patterns:
        - "*"
  labels:
    - "type/dependencies"
    - "scope/infra"
