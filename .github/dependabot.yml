version: 2
updates:

- package-ecosystem: gradle
  # TODO: Update if https://github.com/github/docs/issues/41359 is clarified
  open-pull-requests-limit: -1
  directory: "/"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  labels:
    - "type/dependencies"
    - "scope/backend"
  ignore:
    # Disable dependabot pull requests for Netty
    # In general, our Netty references are temporary overrides, usually applied to address transitive Spring vulnerabilities, and should be configured with caution
    # In general, having conflicting Netty versions in the classpath is not recommended
    - dependency-name: "io.netty:*"
    # We handle Major Spring Boot upgrades manually
    # We do not need to list the individual Spring Boot dependencies here as they are managed by a single property in the build
    - dependency-name: "org.springframework.boot:spring-boot-starter-actuator"
      update-types:
        - "version-update:semver-major"
      # We will only update this dependency if it is necessary for security fixes
  groups:
    spring-boot:
      patterns:
        - "org.springframework.boot:*"
        - "io.spring.dependency-management"
        - "io.modelcontextprotocol.sdk:mcp-spring-webflux"
        - "io.prometheus:*"
        - "org.projectlombok:lombok"
        # We defined this dependency explicitly to fix a vulnerability in a transitive dependency brought by Spring Boot
        - "com.nimbusds:nimbus-jose-jwt"
      # We will handle major upgrades manually
      update-types:
        - "patch"
        - "minor"
    # Update test dependencies separately
    testing:
      # TODO: Consider using dependency-type when https://github.com/dependabot/dependabot-core/issues/13122 is supported
      patterns:
        - "org.testcontainers:*"
        - "org.junit.jupiter:*"
        - "org.assertj:*"
        - "com.gorylenko.gradle-git-properties"
        - "com.bmuschko.docker-remote-api"
        - "org.mockito:*"
        # Byte Buddy is primarily used for testing in libraries like Mockito
        - "net.bytebuddy:byte-buddy"
        # Bouncy Castle is only used for testing purposes in our project
        - "org.bouncycastle:bcpkix-jdk18on"
    devtools:
      patterns:
        - "org.openapitools:*"
        - "com.github.java-json-tools:*"
        - "com.github.victools:*"
        - "org.sonarqube"
    cloud-auth:
      patterns:
        - "com.google.cloud.hosted.kafka:*"
        - "com.google.oauth-client:*"
        - "com.azure:azure-identity"
        - "software.amazon.msk:aws-msk-iam-auth"
    # Update Apache Commons libraries together
    # These dependencies rarely introduce breaking changes
    # And it is safe to update them together without restrictions at the minor/patch level
    apache-commons:
      patterns:
        - "org.apache.commons:*"
    kafka:
      patterns:
        - "org.apache.kafka:*"
        - "io.confluent:*"
      # Kafka major upgrades generally require more work due to breaking changes
      update-types:
        - "patch"
        - "minor"
    schema-tools:
      patterns:
        - "com.github.victools:jsonschema-generator"
        - "com.github.java-json-tools:json-schema-validator"
        - "org.openapitools.openapistylevalidator"
        - "org.openapi.generator"
        - "io.swagger.core.v3:*"
    # Cel is a special case - we only want to handle it separately
    cel:
      patterns:
        - "dev.cel:cel"
    # Lucene is a special case - we only want to handle it separately
    lucene:
      patterns:
        - "org.apache.lucene:*"
      update-types:
        - "patch"
        - "minor"
    gradle-wrapper:
      patterns:
        - "gradle-wrapper"
    # Group all other dependencies we cannot categorize in a single group
    others:
      patterns:
        - "*"
      update-types:
        - "patch"
        - "minor"
- package-ecosystem: docker
  directory: "/api"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  open-pull-requests-limit: 0
  ignore:
    # We handle Major Java updates manually
  - dependency-name: "azul/zulu-openjdk-alpine"
    update-types: ["version-update:semver-major"]
  labels:
    - "type/dependencies"
    - "scope/backend"

- package-ecosystem: npm
  directory: "/frontend"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  open-pull-requests-limit: 0
  versioning-strategy: increase-if-necessary
  labels:
    - "type/dependencies"
    - "scope/frontend"
  groups:
    pnpm-dependencies:
      patterns:
        - "*"
      update-types:
        - "patch"
        - "minor"

- package-ecosystem: "github-actions"
  open-pull-requests-limit: 0
  directory: "/"
  schedule:
    interval: weekly
    time: "10:00"
    timezone: Europe/London
  groups:
    github-actions:
      patterns:
        - "*"
  labels:
    - "type/dependencies"
    - "scope/infra"
